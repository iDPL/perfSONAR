<kickstart>
<!-- This runs on the frontend only -->
<post>
<!-- remove the global perfSONAR attr given to us at install time
set the perfSONAR attribute for the frontend -->
/opt/rocks/bin/rocks remove attr perfSONAR
/opt/rocks/bin/rocks add host attr localhost perfSONAR "&perfSONAR;" 
</post>

<post cond="perfSONAR">
<!-- enable world access to https (not http) -->
/opt/rocks/bin/rocks add firewall host=localhost chain=INPUT \
        flags="-m state --state NEW" \
        protocol=tcp service=https action=ACCEPT network=public rulename="A40-HTTPS-PERFSONAR-PUBLIC-LAN"

<!-- perfSONAR startup seems to disable sshd, undo this madness -->
<!-- Configure NIC Parameters can cause unexpected performance issues, turn it off -->
<file name="/etc/rc.d/rocksconfig.d/post-98-perfSONAR" perms="744">
#!/bin/sh
# perfSONAR startup seems to disable sshd, undo this madness
# Make sure that mysqld is enabled and running

/sbin/chkconfig sshd on
/sbin/service sshd start 

if [ -f /etc/init.d/configure_nic_parameters ]; then
	/sbin/chkconfig --del configure_nic_parameters
fi

/sbin/chkconfig mysqld on
/sbin/service mysqld start 

</file>

</post>

</kickstart>
